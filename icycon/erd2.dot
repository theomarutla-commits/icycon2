digraph IcyconERD {
  rankdir=TB;
  splines=ortho;
  node [shape=record, fontname="Arial", style="filled,rounded"];
  edge [fontname="Arial", fontsize=10];
  
  // Styling
  graph [
    ranksep=1.5,
    nodesep=0.8,
    pad=0.5,
    bgcolor="#ffffff",
    fontname="Arial"
  ];
  edge [
    color="#4a5568",
    penwidth=1.2
  ];

  // Core Models
  User [label="User|id: BigInt|username: varchar(150)\nemail: varchar(254)\npassword: varchar(128)\nis_active: bool\ndate_joined: datetime", fillcolor="#bfdbfe"];
  
  Tenant [label="Tenant|id: BigInt|name: varchar(100)\nregion: varchar(50)\nplan: varchar(50)\nbrand_tone: text\ncreated_at: datetime", fillcolor="#bfdbfe"];
  
  TenantUser [label="TenantUser|id: BigInt|user_id: BigInt\ntenant_id: BigInt\nrole: varchar(20)\ncreated_at: datetime", fillcolor="#bfdbfe"];
  
  Integration [label="Integration|id: BigInt|tenant_id: BigInt\ntype: varchar(50)\noauth_tokens: jsonb\nscopes: jsonb[]\nmetadata: jsonb\nconnected_at: datetime", fillcolor="#bfdbfe"];

  // SEO Models
  Site [label="Site|id: BigInt|tenant_id: BigInt\ndomain: varchar(200)\nsitemaps_url: varchar(200)\ndefault_locale: varchar(10)\nrobots_txt: text\ncreated_at: datetime", fillcolor="#c7d2fe"];
  
  KeywordCluster [label="KeywordCluster|id: BigInt|tenant_id: BigInt\nlocale: varchar(10)\nintent: varchar(100)\nterms: jsonb[]\ncreated_at: datetime", fillcolor="#c7d2fe"];
  
  ContentItem [label="ContentItem|id: BigInt|tenant_id: BigInt\ntype: varchar(50)\nurl: varchar(200)\nstatus: varchar(20)\nlocale: varchar(10)\nbrief_json: jsonb\ndraft_html: text\njson_ld: text\ncreated_at: datetime", fillcolor="#c7d2fe"];
  
  FAQ [label="FAQ|id: BigInt|tenant_id: BigInt\nquestion: varchar(255)\nanswer: text\nsource_urls: jsonb[]\ncreated_at: datetime", fillcolor="#c7d2fe"];

  // Email Models
  EmailList [label="EmailList|id: BigInt|tenant_id: BigInt\nname: varchar(150)\nlawful_basis: varchar(100)\nregion: varchar(50)\nsegment_sql: text\ncreated_at: datetime", fillcolor="#ddd6fe"];
  
  Contact [label="Contact|id: BigInt|tenant_id: BigInt\nemail: varchar(254)\nname: varchar(200)\nsubscribed: bool\nsubscribed_at: datetime\nunsubscribed_at: datetime\nproperties: jsonb", fillcolor="#ddd6fe"];
  
  EmailTemplate [label="EmailTemplate|id: BigInt|tenant_id: BigInt\nname: varchar(150)\nsubject: varchar(300)\nbody_html: text\nbody_text: text\ncreated_at: datetime", fillcolor="#ddd6fe"];
  
  EmailFlow [label="EmailFlow|id: BigInt|tenant_id: BigInt\ntemplate_id: BigInt\nname: varchar(150)\ndescription: text\nenabled: bool\ncreated_at: datetime", fillcolor="#ddd6fe"];
  
  EmailSend [label="EmailSend|id: BigInt|email_list_id: BigInt\ntemplate_id: BigInt\nrecipient_id: BigInt\ntenant_id: BigInt\nsent_at: datetime\nstatus: varchar(50)\nmessage_id: varchar(300)\nbounces: int\ncomplaints: int\nrevenue_attributed: decimal\nlast_error: text\ncreated_at: datetime", fillcolor="#ddd6fe"];

  // Social Models
  SocialAccount [label="SocialAccount|id: BigInt|tenant_id: BigInt\nplatform: varchar(20)\nhandle: varchar(100)\noauth_tokens: jsonb\nconnected_at: datetime", fillcolor="#fae8ff"];
  
  Post [label="Post|id: BigInt|tenant_id: BigInt\nplatform: varchar(20)\nstatus: varchar(20)\nscheduled_at: datetime\nbody: text\nmedia_refs: jsonb[]\ncampaign_id: varchar(50)\ncreated_at: datetime\nposted_at: datetime", fillcolor="#fae8ff"];
  
  SocialLog [label="SocialLog|id: BigInt|tenant_id: BigInt\nplatform: varchar(20)\naction: varchar(100)\nmessage: text\npermalink: varchar(200)\ntimestamp: datetime\npolicy_reference: varchar(200)", fillcolor="#fae8ff"];

  // Relationships with xlabels for better orthogonal layout
  User -> TenantUser [xlabel="1:N"];
  Tenant -> TenantUser [xlabel="1:N"];
  Tenant -> Integration [xlabel="1:N"];
  
  // SEO Relationships
  Tenant -> Site [xlabel="1:N"];
  Tenant -> KeywordCluster [xlabel="1:N"];
  Tenant -> ContentItem [xlabel="1:N"];
  Tenant -> FAQ [xlabel="1:N"];
  Site -> ContentItem [xlabel="1:N"];
  
  // Email Relationships
  Tenant -> EmailList [xlabel="1:N"];
  Tenant -> Contact [xlabel="1:N"];
  Tenant -> EmailTemplate [xlabel="1:N"];
  Tenant -> EmailFlow [xlabel="1:N"];
  Tenant -> EmailSend [xlabel="1:N"];
  EmailList -> EmailSend [xlabel="1:N"];
  EmailTemplate -> EmailSend [xlabel="1:N"];
  Contact -> EmailSend [xlabel="1:N"];
  EmailTemplate -> EmailFlow [xlabel="1:N"];
  
  // Social Relationships
  Tenant -> SocialAccount [xlabel="1:N"];
  Tenant -> Post [xlabel="1:N"];
  Tenant -> SocialLog [xlabel="1:N"];
  SocialAccount -> Post [xlabel="1:N"];
  Post -> SocialLog [xlabel="1:N"];

  // Subgraph for layout
  subgraph cluster_core {
    label = "Core"
    style = "rounded"
    bgcolor = "#f8fafc"
    User; Tenant; TenantUser; Integration;
  }
  
  subgraph cluster_seo {
    label = "SEO"
    style = "rounded"
    bgcolor = "#f8fafc"
    Site; KeywordCluster; ContentItem; FAQ;
  }
  
  subgraph cluster_email {
    label = "Email Marketing"
    style = "rounded"
    bgcolor = "#f8fafc"
    EmailList; Contact; EmailTemplate; EmailFlow; EmailSend;
  }
  
  subgraph cluster_social {
    label = "Social Media"
    style = "rounded"
    bgcolor = "#f8fafc"
    SocialAccount; Post; SocialLog;
  }
}