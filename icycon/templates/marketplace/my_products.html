{% extends "base.html" %}

{% block title %}My Products ‚Äî Marketplace{% endblock %}

{% block breadcrumb %}/ Marketplace / <a href="{% url 'marketplace-home' %}">Home</a> / My Products{% endblock %}

{% block head %}
<style>
  .tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    border-bottom: 2px solid #e0e0e0;
  }
  .tab-button {
    padding: 12px 20px;
    border: none;
    background: none;
    cursor: pointer;
    color: var(--text-light);
    font-weight: 500;
    transition: all 0.2s;
    border-bottom: 3px solid transparent;
    margin-bottom: -2px;
  }
  .tab-button.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  .product-card {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 16px;
    display: flex;
    gap: 20px;
    align-items: start;
  }
  .product-card-image {
    width: 120px;
    height: 120px;
    flex-shrink: 0;
    border-radius: 6px;
    overflow: hidden;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
  }
  .product-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .product-card-content {
    flex: 1;
  }
  .product-card-title {
    font-size: 1.1em;
    font-weight: bold;
    margin: 0 0 8px 0;
    color: var(--primary);
  }
  .product-card-meta {
    font-size: 0.9em;
    color: var(--text-light);
    margin: 0 0 12px 0;
  }
  .product-card-stats {
    display: flex;
    gap: 20px;
    margin-bottom: 12px;
    font-size: 0.9em;
  }
  .product-card-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .product-card-actions a, .product-card-actions button {
    padding: 6px 12px;
    font-size: 0.9em;
  }
  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 0.85em;
    font-weight: 500;
  }
  .status-draft {
    background: #f1f5f9;
    color: #64748b;
  }
  .status-published {
    background: #d1fae5;
    color: #065f46;
  }
  .status-archived {
    background: #fee2e2;
    color: #7f1d1d;
  }
  .empty-state {
    text-align: center;
    padding: 40px;
    color: var(--text-light);
  }
</style>
{% endblock %}

{% block content %}

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
  <h1>My Products</h1>
  <a href="{% url 'product-create' %}" class="button">+ Create New Product</a>
</div>

<!-- Tabs -->
<div class="tabs">
  <button class="tab-button active" data-tab="all">All Products</button>
  <button class="tab-button" data-tab="published">Published</button>
  <button class="tab-button" data-tab="draft">Drafts</button>
  <button class="tab-button" data-tab="archived">Archived</button>
</div>

<!-- All Products Tab -->
<div id="all" class="tab-content active">
  {% if products %}
    {% for product in products %}
      <div class="product-card">
        <div class="product-card-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image }}" alt="{{ product.title }}">
          {% else %}
            üì¶
          {% endif %}
        </div>
        <div class="product-card-content">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
            <h3 class="product-card-title">{{ product.title }}</h3>
            <span class="status-badge status-{{ product.status }}">{{ product.get_status_display }}</span>
          </div>
          <div class="product-card-meta">
            by {{ product.tenant.name }} ‚Ä¢ {{ product.created_at|date:"M d, Y" }}
          </div>
          <p style="margin: 0 0 12px 0; color: var(--text-light);">{{ product.description|truncatewords:30 }}</p>
          
          <div class="product-card-stats">
            <div>‚≠ê {{ product.avg_rating|default:"‚Äî" }}/5</div>
            <div>üí¨ {{ product.review_count }} reviews</div>
            <div>üì¶ {{ product.order_count }} orders</div>
            <div>üí∞ 
              {% if product.pricing_type == 'free' %}
                Free
              {% elif product.pricing_type == 'fixed' %}
                ${{ product.price }}
              {% else %}
                Custom
              {% endif %}
            </div>
          </div>

          <div class="product-card-actions">
            <a href="{% url 'product-detail' product.id %}" class="button" style="background: var(--primary); color: white;">View</a>
            <a href="{% url 'product-edit' product.id %}" class="button" style="background: var(--secondary); color: white;">Edit</a>
            {% if product.status == 'draft' %}
              <form method="post" action="{% url 'product-publish' product.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="button" style="background: #10b981; color: white;">Publish</button>
              </form>
            {% endif %}
            {% if product.status != 'archived' %}
              <form method="post" action="{% url 'product-archive' product.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="button" style="background: #ef4444; color: white;">Archive</button>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <p style="font-size: 1.2em;">No products yet</p>
      <a href="{% url 'product-create' %}" class="button" style="display: inline-block; margin-top: 16px;">Create Your First Product</a>
    </div>
  {% endif %}
</div>

<!-- Published Tab -->
<div id="published" class="tab-content">
  {% if published_products %}
    {% for product in published_products %}
      <div class="product-card">
        <div class="product-card-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image }}" alt="{{ product.title }}">
          {% else %}
            üì¶
          {% endif %}
        </div>
        <div class="product-card-content">
          <h3 class="product-card-title">{{ product.title }}</h3>
          <div class="product-card-meta">
            Published {{ product.published_at|date:"M d, Y" }}
          </div>
          
          <div class="product-card-stats">
            <div>‚≠ê {{ product.avg_rating|default:"‚Äî" }}/5</div>
            <div>üí¨ {{ product.review_count }} reviews</div>
            <div>üì¶ {{ product.order_count }} orders</div>
          </div>

          <div class="product-card-actions">
            <a href="{% url 'product-detail' product.id %}" class="button" style="background: var(--primary); color: white;">View</a>
            <a href="{% url 'product-edit' product.id %}" class="button" style="background: var(--secondary); color: white;">Edit</a>
            <form method="post" action="{% url 'product-archive' product.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="button" style="background: #ef4444; color: white;">Archive</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <p>No published products yet</p>
      <a href="{% url 'product-create' %}" class="button" style="display: inline-block; margin-top: 16px;">Create One Now</a>
    </div>
  {% endif %}
</div>

<!-- Draft Tab -->
<div id="draft" class="tab-content">
  {% if draft_products %}
    {% for product in draft_products %}
      <div class="product-card">
        <div class="product-card-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image }}" alt="{{ product.title }}">
          {% else %}
            üì¶
          {% endif %}
        </div>
        <div class="product-card-content">
          <h3 class="product-card-title">{{ product.title }}</h3>
          <div class="product-card-meta">
            Created {{ product.created_at|date:"M d, Y" }}
          </div>

          <div class="product-card-actions">
            <a href="{% url 'product-edit' product.id %}" class="button" style="background: var(--secondary); color: white;">Edit</a>
            <form method="post" action="{% url 'product-publish' product.id %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="button" style="background: #10b981; color: white;">Publish</button>
            </form>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <p>No draft products</p>
    </div>
  {% endif %}
</div>

<!-- Archived Tab -->
<div id="archived" class="tab-content">
  {% if archived_products %}
    {% for product in archived_products %}
      <div class="product-card">
        <div class="product-card-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image }}" alt="{{ product.title }}">
          {% else %}
            üì¶
          {% endif %}
        </div>
        <div class="product-card-content">
          <h3 class="product-card-title">{{ product.title }}</h3>
          <div class="product-card-meta">
            Archived {{ product.updated_at|date:"M d, Y" }}
          </div>

          <div class="product-card-actions">
            <a href="{% url 'product-detail' product.id %}" class="button" style="background: var(--primary); color: white;">View</a>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <p>No archived products</p>
    </div>
  {% endif %}
</div>

<script>
  document.querySelectorAll('.tab-button').forEach(button => {
    button.addEventListener('click', function() {
      const tabName = this.dataset.tab;
      
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remove active class from buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected tab
      document.getElementById(tabName).classList.add('active');
      this.classList.add('active');
    });
  });
</script>

{% endblock %}
